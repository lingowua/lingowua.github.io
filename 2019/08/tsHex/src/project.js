window.__require=function t(e,o,i){function r(s,h){if(!o[s]){if(!e[s]){var c=s.split("/");if(c=c[c.length-1],!e[c]){var a="function"==typeof __require&&__require;if(!h&&a)return a(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+s+"'")}}var l=o[s]={exports:{}};e[s][0].call(l.exports,function(t){return r(e[s][1][t]||t)},l,l.exports,t,e,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)r(i[s]);return r}({Board:[function(t,e,o){"use strict";cc._RF.push(e,"1c7c7LZfzlJ+KsTeDoZeUH6","Board");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var h=t.length-1;h>=0;h--)(r=t[h])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Config"),s=t("./MapItem"),h=cc._decorator,c=h.ccclass,a=h.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scoreLabel=null,e.tileContainer=null,e.hexSide=5,e.tileHight=120,e.pos_y=250,e.mapItem=null,e.theScore=0,e.hashMap=new Map,e._boardFrameList=new Array,e}return i(e,t),Object.defineProperty(e.prototype,"boardFrameList",{get:function(){return this._boardFrameList},set:function(t){this._boardFrameList=t},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.theScore=0,this.updateScore(),this.setHexagonMap()},e.prototype.updateScore=function(){this.scoreLabel.string="Score:"+this.theScore},e.prototype.setHexagonMap=function(){this.hexSide--;for(var t=-this.hexSide;t<=this.hexSide;t++)for(var e=Math.max(-this.hexSide,-t-this.hexSide),o=Math.min(this.hexSide,-t+this.hexSide),i=e;i<=o;i++){var r=this.hex2pixel({q:t,r:i},this.tileHight),n=this.hex2index(t,i);this.setUpMapItem(r,n)}},e.prototype.hex2index=function(t,e){return(t+this.hexSide)*(2*this.hexSide+1)+e+this.hexSide},e.prototype.hex2pixel=function(t,e){var o=e/2,i=o*Math.sqrt(3)*(t.q+t.r/2),r=3*o/2*t.r+this.pos_y;return cc.v2(i,r)},e.prototype.setUpMapItem=function(t,e){var o=cc.instantiate(this.mapItem),i=o.getComponent(s.default);i.color=n.COLOR.LIGHTGRAY,o.position=t,o.parent=this.node,i.isFill=!1,i.position=t,this.boardFrameList.push(i),this.hashMap[e]=i},e.prototype.resetBoard=function(){for(var t=-this.hexSide;t<=this.hexSide;t++)for(var e=Math.max(-this.hexSide,-t-this.hexSide),o=Math.min(this.hexSide,-t+this.hexSide),i=e;i<=o;i++){var r=this.hex2index(t,i),s=this.hashMap[r];s.color=n.COLOR.LIGHTGRAY,s.opacity=255,s.isFill=!1}},e.prototype.gainScore=function(){for(var t=0,e=new Array,o=-this.hexSide;o<=this.hexSide;o++){for(var i=Math.max(-this.hexSide,-o-this.hexSide),r=Math.min(this.hexSide,-o+this.hexSide),s=!0,h=i;h<=r;h++){var c=this.hex2index(o,h);if(!(a=this.hashMap[c]).isFill){s=!1;break}}if(s){t++;for(h=i;h<=r;h++){c=this.hex2index(o,h);var a=this.hashMap[c];e.push(a)}}}for(h=-this.hexSide;h<=this.hexSide;h++){var l=Math.max(-this.hexSide,-h-this.hexSide),p=Math.min(this.hexSide,-h+this.hexSide);for(s=!0,o=l;o<=p;o++){c=this.hex2index(o,h);if(!(a=this.hashMap[c]).isFill){s=!1;break}}if(s){t++;for(o=l;o<=p;o++){c=this.hex2index(o,h),a=this.hashMap[c];e.push(a)}}}for(var f=-this.hexSide;f<=this.hexSide;f++){l=0,p=0;f>0?l=f-(p=this.hexSide):p=f-(l=-this.hexSide);for(s=!0,o=l;o<=p;o++){h=f-o,c=this.hex2index(o,h);if(!(a=this.hashMap[c]).isFill){s=!1;break}}if(s){t++;for(o=l;o<=p;o++){h=f-o,c=this.hex2index(o,h),a=this.hashMap[c];e.push(a)}}}for(var u=0,d=e;u<d.length;u++){var y=d[u];y.isFill=!1,y.color=n.COLOR.LIGHTGRAY}0!=t&&(this.theScore+=t*e.length,this.updateScore()),this.checkLose()},e.prototype.checkLose=function(){for(var t=0,e=0,o=this.tileContainer.children;e<o.length;e++){for(var i=o[e],r=i.getComponent("TileItem").theList,n=!1,s=-this.hexSide;s<=this.hexSide;s++){for(var h=Math.max(-this.hexSide,-s-this.hexSide),c=Math.min(this.hexSide,-s+this.hexSide),a=h;a<=c;a++){var l=this.hex2index(s,a);if(!this.hashMap[l].isFill){for(var p=0,f=0,u=r;f<u.length;f++){var d=u[f],y=this.hex2index(s+d[0],a+d[1]),v=this.hashMap[y];if(null==v||v.isFill)break;p++}if(p==r.length){n=!0;break}}}if(n)break}n?i.opacity=255:(t++,i.opacity=100)}console.log("the:"+t),3==t&&this.gameLose()},e.prototype.gameLose=function(){this.theScore=0,this.updateScore(),this.resetBoard(),this.checkLose()},r([a(cc.Label)],e.prototype,"scoreLabel",void 0),r([a(cc.Node)],e.prototype,"tileContainer",void 0),r([a(cc.Integer)],e.prototype,"hexSide",void 0),r([a(cc.Integer)],e.prototype,"tileHight",void 0),r([a(cc.Integer)],e.prototype,"pos_y",void 0),r([a(cc.Prefab)],e.prototype,"mapItem",void 0),e=r([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./Config":"Config","./MapItem":"MapItem"}],Config:[function(t,e,o){"use strict";cc._RF.push(e,"47db7HrSw9E1bfqgzPa7KI/","Config"),Object.defineProperty(o,"__esModule",{value:!0}),o.COLOR={LIGHTGRAY:new cc.Color(53,53,53),LIGHTGREE:new cc.Color(198,230,116),DARKGREE:new cc.Color(111,208,129),PURPLE:new cc.Color(132,133,244),ORANGE:new cc.Color(226,153,101),PINK:new cc.Color(235,129,172),YELLOW:new cc.Color(235,205,123)},o.TITLES=[{color:o.COLOR.LIGHTGREE,list:[[[0,0]]]},{color:o.COLOR.DARKGREE,list:[[[1,-1],[0,0],[1,0],[0,1]],[[0,0],[1,0],[-1,1],[0,1]],[[0,0],[1,0],[0,1],[1,1]]]},{color:o.COLOR.PURPLE,list:[[[0,-1],[0,0],[0,1],[0,2]],[[0,0],[1,-1],[-1,1],[-2,2]],[[-1,0],[0,0],[1,0],[2,0]]]},{color:o.COLOR.ORANGE,list:[[[0,0],[0,1],[0,-1],[-1,0]],[[0,0],[0,-1],[1,-1],[-1,1]],[[0,0],[0,1],[0,-1],[1,0]],[[0,0],[1,0],[-1,0],[1,-1]],[[0,0],[1,0],[-1,0],[-1,1]]]},{color:o.COLOR.PINK,list:[[[0,0],[0,1],[0,-1],[1,-1]],[[0,0],[1,-1],[-1,1],[-1,0]],[[0,0],[1,-1],[-1,1],[1,0]],[[0,0],[1,0],[-1,0],[0,-1]],[[0,0],[1,0],[-1,0],[0,1]]]},{color:o.COLOR.YELLOW,list:[[[0,-1],[-1,0],[-1,1],[0,1]],[[-1,0],[0,-1],[1,-1],[1,0]],[[0,-1],[1,-1],[1,0],[0,1]],[[-1,1],[0,1],[1,0],[1,-1]],[[-1,0],[-1,1],[0,-1],[1,-1]],[[-1,0],[-1,1],[0,1],[1,0]]]}],cc._RF.pop()},{}],MapItem:[function(t,e,o){"use strict";cc._RF.push(e,"90c7bB4kDxIspRAlbIoeioh","MapItem");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var h=t.length-1;h>=0;h--)(r=t[h])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,s=n.ccclass,h=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ground=null,e._position=cc.v2(0,0),e._isFill=!1,e._color=null,e._opacity=255,e}return i(e,t),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFill",{get:function(){return this._isFill},set:function(t){this._isFill=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this.ground.node.color=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opacity",{get:function(){return this.ground.node.opacity},set:function(t){this.ground.node.opacity=t},enumerable:!0,configurable:!0}),r([h(cc.Sprite)],e.prototype,"ground",void 0),e=r([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],TileItem:[function(t,e,o){"use strict";cc._RF.push(e,"d2eaa2ZwgxGY46W2eFQjXZf","TileItem");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var h=t.length-1;h>=0;h--)(r=t[h])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Config"),s=t("./MapItem"),h=t("./Board"),c=cc._decorator,a=c.ccclass,l=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tileHight=122,e.tileScale=.7,e.blockItem=null,e.prePos=null,e.theColor=null,e.board=null,e.fillTiles=new Array,e._theList=null,e}return i(e,t),Object.defineProperty(e.prototype,"theList",{get:function(){return this._theList},set:function(t){this._theList=t},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.prePos=this.node.getPosition(),this.setUpTile(),this.addTouchEvent()},e.prototype.setUpTile=function(){var t=this;this.node.setPosition(this.prePos);var e=this.getRandomHex();this.theList=e.list;var o=e.list.map(function(e){return t.hex2pixel(e,t.tileHight)});this.setUpTileItem(o,e.color),this.node.scale=this.tileScale,this.theColor=e.color},e.prototype.hex2pixel=function(t,e){var o=e/2,i=o*Math.sqrt(3)*(t[0]+t[1]/2),r=3*o/2*t[1];return cc.v2(i,r)},e.prototype.getRandomInt=function(t,e){var o=Math.random();return t+Math.floor((e-t)*o)},e.prototype.getRandomHex=function(){var t=n.TITLES[this.getRandomInt(0,n.TITLES.length)],e=t.list[this.getRandomInt(0,t.list.length)];return{color:t.color,list:e}},e.prototype.setUpTileItem=function(t,e){for(var o=0,i=t;o<i.length;o++){var r=i[o],n=cc.instantiate(this.blockItem);n.getComponent(s.default).color=e,n.position=r,n.parent=this.node}},e.prototype.addTouchEvent=function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_START,function(t){}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){var o=e.touch.getDelta();t.node.position=t.node.position.add(o),t.checkCollision(e)}),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){t.tileDrop()}),this.node.on(cc.Node.EventType.TOUCH_END,function(e){t.tileDrop()})},e.prototype.checkCollision=function(t){this.node.children;this.fillTiles=[];for(var e=0,o=this.board.boardFrameList;e<o.length;e++){if(!(p=o[e]).isFill){for(var i=!0,r=0,s=this.node.children;r<s.length;r++){var h=s[r],c=this.node.position.add(h.position);!p.isFill&&p.position.sub(c).mag()<50&&(i=!1,this.fillTiles.push(p))}i&&(p.color=n.COLOR.LIGHTGRAY,p.opacity=255)}}if(this.fillTiles.length==this.node.children.length)for(var a=0,l=this.fillTiles;a<l.length;a++){var p;(p=l[a]).color=this.theColor,p.opacity=150}},e.prototype.tileDrop=function(){if(this.fillTiles.length==this.node.children.length){for(var t=0,e=this.fillTiles;t<e.length;t++){(r=e[t]).color=this.theColor,r.opacity=255,r.isFill=!0}this.node.removeAllChildren(),this.setUpTile(),this.board.gainScore()}else{this.node.setPosition(this.prePos);for(var o=0,i=this.board.boardFrameList;o<i.length;o++){var r;(r=i[o]).isFill||(r.color=n.COLOR.LIGHTGRAY,r.opacity=255)}}},r([l(cc.Integer)],e.prototype,"tileHight",void 0),r([l(cc.Float)],e.prototype,"tileScale",void 0),r([l(cc.Prefab)],e.prototype,"blockItem",void 0),r([l(h.default)],e.prototype,"board",void 0),e=r([a],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./Board":"Board","./Config":"Config","./MapItem":"MapItem"}]},{},["Board","Config","MapItem","TileItem"]);